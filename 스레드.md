#### 스레드

- 프로세스 내에서 실행되는 흐름의 단위
  - 프로세스 내의 주소 공간이나 자원을 공유할 수 있다.
- 하나의 프로그램은 하나 이상의 스레드를 동시에 실행할 수 있다.
  - 이러한 방식을 `멀티 스레드`
- 구성
  - 스레드 ID
  - 프로그램 카운터
  - 레지스터 집합
  - 스택

---

#### 스택이 스레드마다 독립적으로 있는 이유

- 스택
  - 함수 호출 시 전달되는 인자, 되돌아갈 주소값 및 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간
- 스레드마다 독립적인 함수 호출이 가능하다.

---

#### 컨텍스트 스위칭

- 한 프로세스가 CPU를 사용 중일 때 다른 프로세스가 CPU를 사용하기 위해, 이전의 프로세스 상태를 보관하고 새로운 프로세스 상태를 CPU에 적재하는 것
- 실행중인 프로세스가 변경 되면, CPU내 레지스터들의 값이 변경되어야 한다.
  - 변경되기 전에 이전 프로세스가 지니고 있던 데이터를 저장해야 한다. (추후 이어서 실행)
  - 이전 프로세스의 데이터를 저장하고 다음 프로세스를 실행할 때, 새로 실행 되는 프로세스가 아니라면 실행될 때 레지스터들이 지니고 있던 데이터들을 불러와 이어서 실행
- 컨텍스트 스위칭을 할 때마다 오버헤드가 발생

---

#### 스레드 컨텍스트 스위칭

- Context
  - 스레드의 정보
  - 레지스터, 커널, 스택, 사용자 스택 등
- OS는 스레드 작업을 하기위해 해당 스레드 Context를 읽어오고, 다시 다른 스레드로 작업을 변경할 때 이전 스레드의 Context를 저장하고 작업을 진행할 스레드의 Context를 읽어오는 작업

---

#### 생성 - 프로세스 VS 스레드

- 프로세스
  - 자식 프로세스가 생성되면 부모 프로세스가 가진 핸들테이블은 상속된다.
  - 힙, 스택, 데이터, 코드 영역은 독립적으로 생성
  - 프로세스간 데이터를 주고 받기 위해서는  IPC가 필요
  - IPC
    - 각 프로세스는 서로의 메모리 공간에 접근하지 못하기 때문에 `IPC`라는 통신을 사용한다.
    - `IPC`를 통하지 않고는 프로세스간 통신을 할 수 없다.
    - 메일 슬롯, 파이프 등
- 스레드
  - 쓰레드를 생성하면, 새로 만들어진 스레드의 TreadStack 영역만 생성
  - 힙, 스택, 데이터, 코드 영역은 부모 프로세스의 영역을 공유한다.

---

#### 캐쉬

- CPU와 메인메모리 사이에 위치
- CPU에서 한번 이상 읽어들인 메모리의 데이터를 저장
- CPU가 데이터를 요구할 때 캐쉬 메모리에 있으면 메인 메모리를 통하지 않고 바로 캐쉬에서 CPU로 전달

---

#### 컨텍스트 스위칭 - 프로세스 VS 스레드

- 프로세스
  - 프로세스간 공유하는 데이터가 없기 때문에 캐쉬가 이전 프로세스의 데이터를 새로 바뀔 프로세스의 데이터로 바꿔야 한다.
  - 위 과정이 프로세스간 컨텍스트 스위칭의 가장 큰 부담 요소
  - 통신하기 위해서는 `IPC`가 꼭 필요하다.
- 스레드
  - 캐쉬 데이터는 쓰레드가 바뀌어도 쓰레드는 한 프로세스의 데이터를 공유하기 때문에 오버헤드가 프로세스 컨텍스트 스위칭의 오버헤드보다 작다.